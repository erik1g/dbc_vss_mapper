{% extends 'projects/project_base.html' %}
{% load static %}


{% block project_content %}
<div class="container mt-4">

  <h2 class="mb-4">Mapping Editor für Projekt: {{ project.title }}</h2>

  {# ============================ #}
  {# Check: Gibt es ein Mapping?  #}
  {# ============================ #}
  {% if vss_dbc_mapping %}

    <div class="mapping-section">

      <h3>Vorhandenes Mapping: {{ vss_dbc_mapping.title|default:"(Ohne Titel)" }}</h3>
      <p><strong>Erstellt von:</strong> {{ vss_dbc_mapping.created_by.username }}</p>
      <p><strong>Am:</strong> {{ vss_dbc_mapping.created_at|date:"d.m.Y H:i" }}</p>

      <hr>

      <h4>Mapping bearbeiten</h4>

      <div class="mapping-builder">

        <div class="select-section">
          <label for="vss-select">VSS-Signal auswählen:</label>
          <select id="vss-select" class="select"></select>
        </div>

        <div class="select-section">
          <label for="dbc-select">DBC-Signal auswählen:</label>
          <select id="dbc-select" class="select"></select>
        </div>

        <button type="button" id="add-mapping-btn">Mapping hinzufügen</button>
      </div>

      <h5 class="mt-3">Aktuelles Mapping</h5>
      <ul id="mapping-list"></ul>
      <p>{{vss_data_json}}</p>
      <hr>

      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="mapping" id="mapping-input">
        <button type="submit">Speichern</button>
      </form>

      {# Vorhandenes Mapping in JSON für das JS-Script #}
      <script id="existing-mapping-data" type="application/json">
        {{ vss_dbc_mapping.mapping_data|default:"[]"|safe }}
      </script>
    </div>

  {% else %}
    <div class="no-mapping-info">
      <p>Kein Mapping vorhanden. Bitte erst ein Mapping anlegen.</p>
      <a href="{% url 'mapping:create' username project.title %}" class="btn">Neues Mapping erstellen</a>
    </div>
  {% endif %}

  {# ============================ #}
  {# Die Daten für JavaScript     #}
  {# ============================ #}
<script id = "vssDataJSON" type="application/json">
  {{ vss_data_json|safe }}
</script>
<script id = "dbcDataJSON" type="application/json">
  {{ dbc_data_json|safe }}
</script>
<script src="{% static 'mapper/mapper.js' %}"></script>

</div>
{% endblock %}